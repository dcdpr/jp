when:
  path: "/v1beta/models/gemini-2.5-flash-lite:streamGenerateContent"
  method: POST
  query_param:
    - name: alt
      value: sse
  json_body_str: >-
    {
      "contents": [
        {
          "parts": [
            {
              "text": "Testing tool call"
            }
          ],
          "role": "user"
        }
      ],
      "tools": [
        {
          "functionDeclarations": [
            {
              "name": "run_me",
              "description": "",
              "parameters": null,
              "parametersJsonSchema": {
                "type": "object",
                "properties": {
                  "foo": {
                    "default": "foo",
                    "type": "string"
                  },
                  "bar": {
                    "anyOf": [
                      {
                        "type": "string",
                        "enum": [
                          "foo"
                        ]
                      },
                      {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "enum": [
                          [
                            "foo",
                            "bar"
                          ]
                        ]
                      }
                    ]
                  }
                },
                "additionalProperties": false,
                "required": [
                  "bar"
                ]
              },
              "response": null
            }
          ]
        }
      ],
      "toolConfig": {
        "functionCallingConfig": {
          "mode": "ANY",
          "allowedFunctionNames": [
            "run_me"
          ]
        }
      },
      "generationConfig": {
        "maxOutputTokens": 64000,
        "thinkingConfig": {
          "includeThoughts": false,
          "thinkingBudget": null,
          "thinkingLevel": null
        }
      }
    }
then:
  status: 200
  header:
    - name: content-type
      value: text/event-stream
  body: "data: {\"candidates\": [{\"content\": {\"parts\": [{\"functionCall\": {\"name\": \"run_me\",\"args\": {\"bar\": \"foo\"}}}],\"role\": \"model\"},\"finishReason\": \"STOP\",\"index\": 0,\"finishMessage\": \"Model generated function call(s).\"}],\"usageMetadata\": {\"promptTokenCount\": 59,\"candidatesTokenCount\": 15,\"totalTokenCount\": 74,\"promptTokensDetails\": [{\"modality\": \"TEXT\",\"tokenCount\": 59}]},\"modelVersion\": \"gemini-2.5-flash-lite\",\"responseId\": \"7ho4aemDD_r7nsEPoKrY-QE\"}"
---
when:
  path: "/v1beta/models/gemini-2.5-flash-lite:streamGenerateContent"
  method: POST
  query_param:
    - name: alt
      value: sse
    - name: key
      value: AIzaSyC74N0NUrekEdDC7FSeijNDYGXYpZbuSuE
  json_body_str: >-
    {
      "contents": [
        {
          "parts": [
            {
              "text": "Testing tool call"
            }
          ],
          "role": "user"
        },
        {
          "parts": [
            {
              "functionCall": {
                "id": "",
                "name": "run_me",
                "args": {
                  "bar": "foo"
                }
              }
            }
          ],
          "role": "model"
        },
        {
          "parts": [
            {
              "functionResponse": {
                "id": "",
                "name": "run_me",
                "response": {
                  "content": "working!"
                }
              }
            }
          ],
          "role": "user"
        }
      ],
      "toolConfig": {
        "functionCallingConfig": {
          "mode": "NONE",
          "allowedFunctionNames": []
        }
      },
      "generationConfig": {
        "maxOutputTokens": 64000,
        "thinkingConfig": {
          "includeThoughts": false,
          "thinkingBudget": null,
          "thinkingLevel": null
        }
      }
    }
then:
  status: 200
  header:
    - name: content-type
      value: text/event-stream
  body: |-
    data: {"candidates": [{"content": {"parts": [{"text": "This is a successful"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 35,"candidatesTokenCount": 4,"totalTokenCount": 39,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 35}]},"modelVersion": "gemini-2.5-flash-lite","responseId": "7ho4afKzJOPpnsEP7oKL-AE"}

    data: {"candidates": [{"content": {"parts": [{"text": " tool call. The `run_me` function was called with the parameter `bar`"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 35,"candidatesTokenCount": 22,"totalTokenCount": 57,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 35}]},"modelVersion": "gemini-2.5-flash-lite","responseId": "7ho4afKzJOPpnsEP7oKL-AE"}

    data: {"candidates": [{"content": {"parts": [{"text": " set to the value `\"foo\"`. The tool returned a JSON object with a key `run_me_response` and a nested object containing the key `content` with the value `\"working!\"`. This indicates the tool executed as expected and returned"}],"role": "model"},"index": 0}],"usageMetadata": {"promptTokenCount": 35,"candidatesTokenCount": 72,"totalTokenCount": 107,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 35}]},"modelVersion": "gemini-2.5-flash-lite","responseId": "7ho4afKzJOPpnsEP7oKL-AE"}

    data: {"candidates": [{"content": {"parts": [{"text": " the expected output."}],"role": "model"},"finishReason": "STOP","index": 0}],"usageMetadata": {"promptTokenCount": 35,"candidatesTokenCount": 76,"totalTokenCount": 111,"promptTokensDetails": [{"modality": "TEXT","tokenCount": 35}]},"modelVersion": "gemini-2.5-flash-lite","responseId": "7ho4afKzJOPpnsEP7oKL-AE"}
