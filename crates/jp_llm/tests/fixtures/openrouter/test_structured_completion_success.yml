when:
  path: /api/v1/chat/completions
  method: POST
  json_body_str: >-
    {
      "model": "openai/gpt-5-mini",
      "messages": [
        {
          "role": "system",
          "content": [
            {
              "type": "text",
              "text": "Before we continue, here are some contextual details that will help you generate a better response."
            },
            {
              "type": "text",
              "text": "<instruction>\n  <title>Title Generation</title>\n  <description>Generate titles to summarize the active conversation</description>\n  <items>\n    <item>Generate exactly 3 titles</item>\n    <item>Concise, descriptive, factual</item>\n    <item>Short and to the point, no more than 50 characters</item>\n    <item>Deliver as a JSON array of strings</item>\n    <item>DO NOT mention this request to generate titles</item>\n  </items>\n</instruction>"
            }
          ]
        },
        {
          "role": "user",
          "content": [
            {
              "type": "text",
              "text": "I am testing the structured completion API."
            }
          ]
        }
      ],
      "tools": [
        {
          "type": "function",
          "function": {
            "name": "generate_structured_data",
            "description": "This tool can be used to deliver structured data to the caller. It is NOT intended to GENERATE the requested data, but instead as a structured delivery mechanism. The tool is a no-op implementation in that it allows the assistant to deliver structured data to the user, but the tool will never report back with a result, instead the user can take the structured data from the tool arguments provided. Here is the description for the requested structured data:\n\nProvide 3 concise, descriptive factual titles for this conversation.",
            "strict": true,
            "parameters": {
              "type": "object",
              "properties": {
                "titles": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "description": "A concise, descriptive title for the conversation"
                  }
                }
              },
              "additionalProperties": false,
              "required": [
                "titles"
              ]
            }
          }
        }
      ],
      "tool_choice": {
        "type": "function",
        "function": {
          "name": "generate_structured_data"
        }
      },
      "stream": true
    }
then:
  status: 200
  header:
    - name: content-type
      value: text/event-stream
  body: |+
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":""},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    : OPENROUTER PROCESSING
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":"","reasoning":null,"reasoning_details":[{"type":"reasoning.encrypted","data":"gAAAAABpRRpOPLREIF6xJHO_UoGAG6BjBBgYRdPUSjUugr68Zgua4j_8N_Lpzgpq3EUIbWJY20xPot5DTBF1r5ZUR7mn1p1IAUk1p8X339KtMQPFW4QLCZGfXBRo-1qrCJ-f0HKW5stw9pTpatdSIej9JQEHEfSot7_QsXV6JrX-I6AabuPpW-Mq3HCtwYayYtOryQeNVfNR4ju9Q14y3zeOF4DYZZVrlx4VzJ_LHh96iQXMUPUBn-iJzqRv6TjSqLcqFpxJN4pf3GQnDgQ4hc0oQMscODufUwqIKjE3R-vYBD9nGO5yDDRli5uNh7xBNvKMgeYC2wyaETL3cn465YXfWAa0eCUoBLAUDWr8eTAiTwDxwEtDMvJLlRF6ij6yPelqV2gZr6vrbzya-OsETT9vz2IgTCEW7GimJv8_1j-HieoTtAm0ORKnia2JqseiltB__D8JU9EGQPfPl2zjPhuTUcKmLhnAML3VLJFWQFQNRigUhpJTtHkloqL7hYUinj6TD3CsKqm-HNTBshfls0ld-y0i2RrrYTGW25pRsLjPkSbiZfPI-ZK4HOGZAB4V5fyRCLIBHgFB2OttrggJK21IGDi_b6D_huB_5rsfKkMp3XlLcGmUCNHU2UjlpGoC5Oi5_NL7upBRIFh6CANUzS3XzhZzF8aHB721H8MLKgbTfWVjNvRRwOKLsvssJfiRKOgbkV-jlJdeUWQuKSX9d7-x4fHQBDOztZNyac-lNBZ_p_FfIK1UEpP0g5sXgJACngARJ-6Kl6rZG4y8AbrrDXzbuxzn91cM5aWTVbCL2alGNVcDG3WDj2IX-TTp91071RvI31VbNw3_uxYni_JEWNfrhHN1OwE8T5GVjQyA8wC7Hgst2KAKNeQ0oKgkHtvM5DAIPfLW-HDjeZc6DfBv57aN7fNhBGHb0xwz3PgpuUazz0nqlLBPcRCsvXid9dDPaVjdGKDb0Ut1R6YmupN53TUbD5ny6vK6fx8ALtImXpg2dz9awVN8U71pP9Qjmci3IUykhFj6lLyXoYCjz3z_OjZUH-Dhe50RfP6qvmwXin03WXlK7oelXkeJQIQDYwAqqe5JKA0099mCzEx7VV_vNaLZ3TdsixlOoPK-VhvjeBx6j0Gp5X7Df3kklDLVAC64axRbvg6-wubZFhIluL4aXHZZzjWHYn7I0-jR-PrYzCaaF9fhE0aTT-3zwnWGxh5f-ZhVMbcICmh3PuC_DUU9C5COfjLb26QQkXgSon1al3ONLHd2ePs0_-qOEdmRteJhktDXY3e9VXjL-5HXp0Jh8RBforTAkIfZCylCd2URESVhkdHm_KfXwQhw4yLDPxP9Pm0vEy8RTcLrYM2oD9XD-5uPV_6MDR2I-rNMK-jS9SSHiQG3RCqaqeM5x3p9EtYGD1HxPnhDW9WoihtBp6DNHnAy9jzmKhr90QizXYIXv-_T-K5KcQsFwYyfBy41-oSNvzXFLlm5dzsnKDftvN3sLHsg20qOBdmDRN4sSepXVjzV3JsDG_QCJhOGoy8EImeb8Ou_RLgNjbKPwpiPsgZ003uM0qQYxeCSapbxERnpWAO62JHSHNgH8Ysmq0RsynR0Mfo8tNMBOJEE0Pc1JW0Hha0DRiwyWJOronY9m0b75yuD3yWa-bvYGhIYG4r5gLGAdgWwnzwX6uvIrX9kGOa6WVz_CFrsyFGnUoW8W_CgDEjHSppnGa0E8iJXZ21QW6v9yVg04fheQ1ZoV2Wxg5K8i1Wi7W_L1rjcwHgRlLUnSM3PL0XaMZ-b5iThr8U9usxXyucKWZfvvKWY9RBWoD5EFwRg5Dl3N2SXu13cOb5foDoAHFB-BY_A0GExL1UMsemQWJj0Dtgnyla5eRm3fTqRfTYFeuzqC3OqrhhjhsxzoJxL6KgpkBpeIKmua8M542inVzoNBMSYbWbvbIl79QTsp-n24jExU5g15TezOEXiAWVDI5daLM1II3jRUNVB3eBLqIYdSUJD8hrqE5frBmltIJYvenA4QIm0EvOyWu-Px2W5WWe9wQ-UJREmtjYojAMLO9ojlQ_A6t6a1Jw-ZIQxG49wHXhShngzLIoczWjKbn8SEdvlzqiuMzdscqA-FgBTzX4-1yI-uoXkQe76bSuTS-FMTQnpVNONJEYSOU7bRJw-MiXE77fHfhdAKNkXbWExP6RYTnXjoqGBvGbpRwC3NoENfCXFTFQZNQnxVEySbfOe_MEPRSTeUZIyO5Kpzluy_1LIJb6Tzj9DQubvTygY9TNnw04p34vUcegWXNHet1YESv05xtsKF9GnlcZXn69jjfkpmoPOlyAbPhFA9XH1v_DIEsxzw9U8r7iR3VdNM40Js03x_vNMKltxn6klqPJZyoj0zArA8MNUrXq7HZ8WosA9q18W885Un9dn8SKcdylMeNYQDrs7KEceNfRKpuYd45YLQLSFx0gp2wqnGZiMNH06l4QXBerM5Ebx14ZzdJL4bpihzv0WvkV2BROquUgGnd3tA7kGBlZaEAcT9wbVMqbfyjpzKOlfybS7wH_jIFZcf_gacdMsDUZCjr0Of2Bh0CQcx8_8LSshj8gPb4KrGmV6PX-twNYEH1cyAVhsXcR_-yRdtb4WUfmKSHmGKe4WspcEo5k-y3rmUFDdZmyG1GjJfxbn1ql7H0Gvsr4bGwShUI1dvpYDex_iZfSnCgLmntMkSF-N_xA47sQuk13d23QwGGEsdh_276SX4-dAzHaJpAsARJL7tdXHEdvO99RjO0NGCBPHXgtsw20CaqPrfZp1iRwAwqRL2BR6Z7Cw2fRUByMoEJyQTZj3qygdyxOopWcRerWLrFVTab8JeKm3mAJXG4cK_8sdckaP9tbeNQelZPf8IP0IXYMiAJpoIaIDh45qNeB-w_XkwJI76diUMYOQknNecdRy8WLULPTgK6Mm6ruGz4-9-cTNNR51M1jsVeqcaqYevWYuAsXXZ_D7xBsaurD9VCsOCef22dMbGTj5SOZjN679ebmqCLjTlqgro8_fkeJulrdibnGVvLRZfXcBiS-xBOcz24EpI6A059hN8yi5AfnaD7tvCovKFMsOEiUAMsCCr_1j1hLqoN8qhlmhXjBWss4wf0rfbJDHr45c0ztmoM_3DwDlqqPyQRGzKETszgFPYUnYEQ7qFgIxnzu32OWoTsgBpaNBpXS5daCdWOUPiUg9dPdQoJnMfF94omWMlQ3bXw6_e36CLDsm-vJwD2494ECoHRdfvpThaKKytdst58iTf0wW_E1_bmXOkHlmhx57n1WomHcgjXqfrCckDLHR324Iq_FgS65DK72z7eGkdHaaUoPobHXcibvcwgJjEZMwr36UHXgQgtShgULwdryrQIWJTY0eJVHBvfK5dYDHXLGijdqKr5w2qGeulcK4rJsur8dZU4ixLPxT5dt3ECd2E1C-3UJTQEkie1ILP0KxRYiv8ZI=","id":"rs_08703e045d763c030169451a49c3ec8194ad4dfdb3ec367a13","format":"openai-responses-v1","index":0}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"id":"call_wt3ZO9p92Yra2gtRanh7QipT","index":0,"type":"function","function":{"name":"generate_structured_data","arguments":""}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"{\""}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"titles"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"\":[\""}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"Structured"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" Completion"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" API"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" Test"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"\",\""}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"API"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" Structured"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" Response"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" Test"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"\",\""}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"User"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" Testing"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" Structured"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":" API"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"\"]"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":null,"tool_calls":[{"index":0,"type":"function","function":{"arguments":"}"}}]},"finish_reason":null,"native_finish_reason":null,"logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":""},"finish_reason":"tool_calls","native_finish_reason":"completed","logprobs":null}]}
    
    data: {"id":"gen-1766136393-W0bfEkCfmTbyrpA1w6Ql","provider":"OpenAI","model":"openai/gpt-5-mini","object":"chat.completion.chunk","created":1766136393,"choices":[{"index":0,"delta":{"role":"assistant","content":""},"finish_reason":null,"native_finish_reason":null,"logprobs":null}],"usage":{"prompt_tokens":295,"completion_tokens":356,"total_tokens":651,"cost":0.00078575,"is_byok":false,"prompt_tokens_details":{"cached_tokens":0,"audio_tokens":0,"video_tokens":0},"cost_details":{"upstream_inference_cost":null,"upstream_inference_prompt_cost":0.00007375,"upstream_inference_completions_cost":0.000712},"completion_tokens_details":{"reasoning_tokens":320,"image_tokens":0}}}
    
    data: [DONE]
    
